name: evpn_mh

topology:
  kinds:
    arista_ceos:
      image: localhost/ceos:4.34.2f
      binds:
        - __clabDir__/mymapping.json:/mnt/flash/EosIntfMapping.json:ro
  groups:
    spines:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - __clabNodeDir__/daemons:/etc/frr/daemons
        - __clabNodeDir__/frr.conf:/etc/frr/frr.conf
        - __clabNodeDir__/vtysh.conf:/etc/frr/vtysh.conf
        - __clabNodeDir__/setup.sh:/setup.sh
    leafs:
      kind: arista_ceos
    hosts:
      kind: linux
      image: praqma/network-multitool:latest
      binds:
        - __clabNodeDir__/setup.sh:/setup.sh
      cmd: bash /setup.sh

  nodes:
    leaf1-1:
      group: leafs
      mgmt-ipv4: 172.20.20.100
    leaf1-2:
      group: leafs
      mgmt-ipv4: 172.20.20.101
    leaf1-3:
      group: leafs
    leaf1-4:
      group: leafs

    spine1-1:
      group: spines
    spine1-2:
      group: spines

    host1-1:
      group: hosts
    host2-1:
      group: hosts

  links:
    # peer link
    - endpoints: ["leaf1-1:eth4", "leaf1-2:eth4"]
    # uplinks
    - endpoints: ["leaf1-1:eth1", "spine1-1:eth1"]
    - endpoints: ["leaf1-2:eth1", "spine1-1:eth2"]
    - endpoints: ["leaf1-3:eth1", "spine1-1:eth3"]
    - endpoints: ["leaf1-4:eth1", "spine1-1:eth4"]
    - endpoints: ["leaf1-1:eth2", "spine1-2:eth1"]
    - endpoints: ["leaf1-2:eth2", "spine1-2:eth2"]
    - endpoints: ["leaf1-3:eth2", "spine1-2:eth3"]
    - endpoints: ["leaf1-4:eth2", "spine1-2:eth4"]
    # downlinks
    - endpoints: ["leaf1-1:eth3", "host1-1:eth1"]
    - endpoints: ["leaf1-2:eth3", "host1-1:eth2"]
    - endpoints: ["leaf1-3:eth3", "host2-1:eth1"]
    - endpoints: ["leaf1-4:eth3", "host2-1:eth2"]
